<body>
    <canvas id="canvas" width="300" height="200"></canvas>
    <input type="checkbox" id="check"/>
    <a href="" id="downloadlink">download movie</a>
</body>

<style>
    #canvas {
        border: solid 1px;
    }
</style>

<script>
    const canvas = document.getElementById('canvas');
    const check = document.getElementById('check');
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    let recorder;
    let drawing = false;

    canvas.addEventListener('mousemove', (e) => {
      if (drawing) {
        const rect = e.target.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        ctx.fillStyle = "black";
        ctx.fillRect(x, y, 2, 2);
      }
    });
    
    canvas.addEventListener('mousedown', function(e) {
      drawing = true;
    });
    
    canvas.addEventListener('mouseup', function() {
      drawing = false;
    });

    check.addEventListener('change', function() {
        console.log(check.checked)
        if (check.checked) {
            const stream = canvas.captureStream();
            recorder = new MediaRecorder(stream, { mimeType: "video/webm;codecs=vp9" });
            recorder.start();
            console.log('TRUE')
        } else {
            recorder.stop();
            const link = document.querySelector("#downloadlink");
            recorder.ondataavailable = e => {
              console.log("ondataavailable", e);
              const blob = new Blob([e.data], { type: e.data.type });
              const blobUrl = URL.createObjectURL(blob);
              link.download = "movie.webm";
              link.href = blobUrl;
            };
            console.log('FALSE')
        }
    })
</script>